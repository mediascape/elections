<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="chrome=1" />
  <title>Remove traces</title>

  <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Stint+Ultra+Expanded" />
  <link rel="stylesheet" type="text/css" href="stylesheets/bootstrap.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/bootstrap-responsive.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/styles.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <!--[if lt IE 9]>
  <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>
  <body class="woodman">
    <div class="container">
      <section class="row-fluid">
        <div class="span2 offset1 sidemenu">
          <div class="navbar navbar-static-top">
  <div class="navbar-inner">
    <ul class="nav">
      <li >
        <a href="index.html">Home</a>
      </li>
      <li >
        <a href="getstarted.html">Get started</a>
      </li>
      <li >
        <a href="config.html">Configure</a>
      </li>
      <li >
        <a href="precompiler.html">Precompile</a>
      </li>
      <li >
        <a href="contribute.html">Contribute</a>
      </li>
      <li >
        <a href="about.html">About</a>
      </li>
    </ul>
  </div>
</div>
        </div>
        <div class="span8 main">
          <h1>Remove traces</h1>
          <p>When you package your application for release, you may not want that version to log anything, be it only because it is quite useless to log things to a destination that no one will ever see. While it&#39;s easy to silence Woodman, leaving the calls to Woodman in the code has a couple of drawbacks:</p>

<ul>
<li>Size often matters for a release version. It is common practice to run a JavaScript minifier to shrink the size of the code to a bare minimum before release. Including Woodman and calls to Woodman take up useful bytes for just about nothing.</li>
<li>Speed matters as well and, even though they do not do anything when Woodman is configured not to log anything, calls to Woodman are regular JavaScript function calls that consume a little bit of time and memory.</li>
</ul>

<p>Not being able to remove logs from the code is probably one of the reasons why most JavaScript libraries do not contain logging traces in the first place. Woodman would not be <em>that</em> useful if it could not address that issue. Fortunately, it can!</p>

<p>The <em>precompiler</em> that comes bundled with Woodman strips your code from all references to Woodman.</p>

<h2><a id="run-the-precompiler"></a>Run the precompiler</h2>

<p>To run the precompiler on a JavaScript file, clone Woodman&#39;s repository to some local folder, run <code>npm install</code> on that folder and run the following node.js command:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">node {PATH TO WOODMAN}/precompile/precompiler.js {JSFILE}
</code></pre></div>
<p>This will output the resulting code directly to the console. To output the result to a named file, simply redirect the console to a file or provide an output file:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">node {PATH TO WOODMAN}/precompile/precompiler.js {JSFILE} {OUTPUTJSFILE}
</code></pre></div>
<p>This may take up some time, from a couple of seconds for small JavaScript files up to a minute or so for large JavaScript files (&gt;500Kb).</p>

<p>The precompiler can also process recursively all JavaScript files in a folder and create a similar folder structure where all JavaScript files have been precompiled:
<code>
node {PATH TO WOODMAN}/precompile/precompiler.js {JSFOLDER} {OUTPUTFOLDER}
</code></p>

<h2><a id="what-the-precompiler-does"></a>What the precompiler does</h2>

<p>The precompilation:</p>

<ul>
<li>removes references to Woodman in AMD define calls, e.g.:
<code>define([&#39;woodman&#39;], function (woodman) { ... });</code></li>
<li>removes references to Woodman in node.js require calls, e.g.:
<code>var woodman = require(&#39;woodman&#39;);</code></li>
<li>removes calls to <code>woodman.load</code> or <code>woodman.start</code>, replacing it by a call to its callback argument directly if they are available</li>
<li>removes calls such as <code>var logger = woodman.getLogger()</code>, dropping the variable declaration along the way</li>
<li>removes calls to <code>logger.*</code> where <code>logger</code> is the variable name defined as the result of a call to <code>woodman.getLogger()</code></li>
<li>removes the configuration definition used in the call to <code>woodman.initialize</code> or <code>woodman.load</code></li>
</ul>

<h2><a id="limits-of-the-precompiler"></a>Limits of the precompiler</h2>

<p>If you are familiar with what an <em>Abstract Syntax Tree (AST)</em> is, you probably know that manipulating JavaScript code to produce a slightly modified version of that code is not an easy task. While the precompilation process should account for all usual uses of the Woodman library, it does have its limits.</p>

<p>Here are examples of code correctly handled by the precompilation:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="c1">// Logger variable defined and assigned on different lines</span>
<span class="c1">// (but note the variable declaration is not removed in that case)</span>
<span class="kd">var</span> <span class="nx">logger</span><span class="p">;</span>
<span class="nx">logger</span> <span class="o">=</span> <span class="nx">woodman</span><span class="p">.</span><span class="nx">getLogger</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>

<span class="c1">// Logger variable defined with another name</span>
<span class="kd">var</span> <span class="nx">anotherLogger</span> <span class="o">=</span> <span class="nx">woodman</span><span class="p">.</span><span class="nx">getLogger</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>

<span class="c1">// Logger variable defined with along with other variables</span>
<span class="c1">// (the function keeps the variable but nulls it in that case)</span>
<span class="kd">var</span> <span class="nx">logger</span> <span class="o">=</span> <span class="nx">woodman</span><span class="p">.</span><span class="nx">getLogger</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">),</span> <span class="nx">j</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span>

<span class="c1">// Logger used directly</span>
<span class="nx">woodman</span><span class="p">.</span><span class="nx">getLogger</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">).</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">);</span>
</code></pre></div>
<p>Some cases that are not correctly handled by the precompilation function,
and that may generate invalid code in the end:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="c1">// NOT SUPPORTED: Calling a trace function within another statement</span>
<span class="kd">var</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">))</span> <span class="p">{}</span>
<span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="nx">logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">);</span>

<span class="c1">// NOT SUPPORTED: Assigning the logger to another variable</span>
<span class="kd">var</span> <span class="nx">logger</span> <span class="o">=</span> <span class="nx">woodman</span><span class="p">.</span><span class="nx">getLogger</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
<span class="nx">truc</span> <span class="o">=</span> <span class="nx">logger</span><span class="p">;</span>
<span class="nx">truc</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">);</span>

<span class="c1">// NOT SUPPORTED: Re-assigning the logger variable</span>
<span class="kd">var</span> <span class="nx">logger</span> <span class="o">=</span> <span class="nx">woodman</span><span class="p">.</span><span class="nx">getLogger</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
<span class="nx">logger</span> <span class="o">=</span> <span class="nx">somethingelse</span><span class="p">;</span>
<span class="nx">logger</span><span class="p">.</span><span class="nx">machin</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>

<span class="c1">// NOT SUPPORTED: Not using the dot notation to call Logger functions</span>
<span class="kd">var</span> <span class="nx">logger</span> <span class="o">=</span> <span class="nx">woodman</span><span class="p">.</span><span class="nx">getLogger</span><span class="p">(</span><span class="s1">&#39;blah&#39;</span><span class="p">);</span>
<span class="nx">logger</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">](</span><span class="s1">&#39;Oh no!&#39;</span><span class="p">)</span>
</code></pre></div>
<p>Internally, Woodman&#39;s precompiler uses <a href="http://esprima.org/">Esprima</a> to produce the AST and an adapted version of <a href="https://github.com/substack/node-falafel">Falafel</a> to update the code.</p>

          <footer class="text-center">
  <p>
    Copyright (c) 2013 <a href="http://joshfire.com">Joshfire</a>, all rights reserved<br/>
    Code licensed under an <a href="about.html#license">MIT license</a>
  </p>

  <p>
    Built and maintained by <a href="http://twitter.com/tidoust">@tidoust</a><br/>
    Woodman logo by <a href="http://twitter.com/mauriz">@mauriz</a><br/>
  </p>

  <ul class="inline">
    <li><a href="https://github.com/joshfire/woodman">Source code</a></li>
    <li><a href="https://github.com/joshfire/woodman/issues">Issues</a></li>
    <li><a href="changelog.html">Changelog</a></li>
  </ul>

  <p><small>Site hosted on GitHub Pages</small></p>
</footer>

<script src="javascripts/scale.fix.js"></script>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
  try {
    var pageTracker = _gat._getTracker("UA-24118306-9");
  pageTracker._trackPageview();
  } catch(err) {}
</script>

        </div>
      </section>
    </div>
  </body>
</html>