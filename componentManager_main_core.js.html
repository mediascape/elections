<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: componentManager/main/core.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: componentManager/main/core.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
** Long Library Name:
**      Adaptation toolkit Module
**
** Acronym and its version:
**      Adaptation toolkit v1.0
**
** Copyright claim:
**      Copyright ( C ) 2013-2014 Vicomtech-IK4 ( http://www.vicomtech.org/ ),
**      all rights reserved.
**
** Authors (in alphabetical order):
**      Ana Dominguez &lt;adominguez@vicomtech.org>
**      IÃ±igo Tamayo &lt;itamayo@vicomteh.org>,
**      Mikel Zorrila &lt;mzorrilla@vicomtech.org>,
**
** Description:
**      It is the core of componentManager, where all functionality converge to give a final
**	logic.
**
** Development Environment:
**      The software has-been Implemented in JavaScript, and tested in Chrome and firefox
**      browsers.
**
** Dependencies:
**      As accounts package depends on other libraries, the user must adhere to and
**      keep in place any Licencing terms of those libraries:
**              requirejs v2.1.14 (http://requirejs.org/)
**
** Licenses dependencies:
**      License Agreement for requirejs:
**              BSD 3-Clause license (http://opensource.org/licenses/BSD-3-Clause)
**              MIT license (http://opensource.org/licenses/MIT)
**
*/
/**
* The main functionality is to manage the components . It uses the css Parser to get
* the custom css properties related with webcomponents, also parses the webcomponents located at the document,
* associates them and take cares of all updates happened in the context. It is also useful for used as register,
* since javascript has an asincrone natural behaviour.
*
* @module mediascape/AdaptationToolkit/componentManager/main/core
*
* @alias mediascape/AdaptationToolkit/componentManager/main/core
*/

define(
  [
  ],
  function(_){

    var core = function(){

      var components = [];
      var componentStatus = undefined;
      this.init = function (){
        console.log("BARRUAN");
        var layoutProp=['order','rwidth','propx','propy','bestfit','required',"needs","duplicable","movable","icon"];
        var file='/resources/layout/components.layout';
        var _this = this;
        this.parseComponents(file,layoutProp).then(function(cmps){
          console.log("PARSING",cmps);
          var event = new CustomEvent("adaptationToolkit-ready", {"detail":{"loaded":true,components:cmps}});

          setTimeout(function(){document.dispatchEvent(event);},2000);
          _this.components = cmps;
        });
      }
      this.setComponentValue = function (cmp,property,value) {
          var cmpId = cmp.getAttribute('compid');
          if (cmpId) throw new Error(cmp + " does not exists");
          cmp.setAttribute(property,value);
      };
      this.parseComponents = function (file,layoutProp) {
        var cmps = document.body.children;
        var CssParser = mediascape.AdaptationToolkit.componentManager.cssParser;

        if (cmps.length ===0) throw new Error("there is no webcomponent to parse");
        // Filter only webcomponents
      //  cmps = _.toArray(cmps);
        var promise = CssParser.readCustomCss(file,layoutProp).then(function(data){

            components = Array.prototype.filter.call(cmps,function(el,i){
            // custom elements determines that name has to be composite tag separeted by "-". ex : my-component
                if (el.nodeName.split('-').length >= 2 ){
                    var id = el.getAttribute('id');
                    el.setAttribute('touch-action','none');
                    el.setAttribute('drag-resize','');
                    [].slice.call(el.querySelectorAll('div,span')).forEach(function(htmlelement){
                        htmlelement.setAttribute('touch-action','none');
                        htmlelement.style.webkitUserSelect="none";
                    });
                    el.setAttribute('compId','compId'+i);
                    data.forEach(function(properties){
                        if (Object.keys(properties).indexOf(id)>-1) {
                          el['lproperties'] = properties[id] ;
                          if (el['lproperties'].movable === "true")
                             mediascape.AdaptationToolkit.uiComponents.addMovablePanel(el);

                        }

                    });

                // Inject component-query to each webcomponent
                //  el.setAttribute('extends','component-query');
                  return true;
                }
                else {
                  return false;
                }
             });
             // gecko does not support
             wrappComponents(components);
           return components;
        });
        return promise;
      };
      this.getComponents = function (){
        return components;
      }
      this.getComponentsStatus = function (){
        return componentStatus || [];
      }
      this.setComponentsStatus = function (status){
        componentStatus = status;
      }
      this.checkComponentsReady = function(){
          var ready = components.every(function(cmp){
                console.log(cmp.done);
                return cmp.done;
          });
          if (ready){
            var event = new CustomEvent('components-ready', { 'detail': 'emulate' });
            window.dispatchEvent(event);
            clearInterval(iid);
          }

      }
      this.getFile = function(file){
        return $.ajax({
          url: file,
          dataType: "text"
        });
      };
	  this.getComoponentsToShow = function (){
    if (componentStatus)
		 return componentStatus.filter (function(c){
				if (c.show) return true;}).map(
				function(c2){
					return document.querySelector("div [compId='"+c2.compId+"']");
        });
     else return [];

	  }
      this.getHiddenComponents = function(showedCmp){
        return components.filter(function(cmp){
               return showedCmp.every(function(cmp2){
                      if (cmp2.id !== cmp.id) return true;
                      else return false;
               });
        });
      }
      this.setMenu = function (show){
         if (show){
            mediascape.AdaptationToolkit.uiComponents.showComponentMenu(components);
         }
         else {
             mediascape.AdaptationToolkit.uiComponents.hideComponentMenu(components);
         }

      }

      var iid = setInterval(this.checkComponentsReady.bind(this),500);
      // Wrapp components into main div #componentsContainer does not work on gecko
      function wrappComponents (cmps){
        var componentsContainer = document.createElement('div');
        componentsContainer.id = "componentsContainer";
        document.body.appendChild(componentsContainer);
        cmps.forEach(function(c){
          var node = document.querySelector('#'+c.id);
          console.log(node);
          componentsContainer.appendChild(node);
        })

      }

      document.addEventListener('mediascape-modules-ready',this.init.bind(this),false);
    };


    core.__moduleName = "core";
    return core;

  });
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-mediascape_AdaptationToolkit_adaptation_modules.html">mediascape/AdaptationToolkit/adaptation/modules</a></li><li><a href="module-mediascape_AdaptationToolkit_adaptation_multiDeviceAdaptation_mdadaptation.html">mediascape/AdaptationToolkit/adaptation/multiDeviceAdaptation/mdadaptation</a></li><li><a href="module-mediascape_AdaptationToolkit_adaptation_UIAdaptation_layoutConstructor.html">mediascape/AdaptationToolkit/adaptation/UIAdaptation/layoutConstructor</a></li><li><a href="module-mediascape_AdaptationToolkit_adaptation_UIAdaptation_layouts_pip.html">mediascape/AdaptationToolkit/adaptation/UIAdaptation/layouts/pip</a></li><li><a href="module-mediascape_AdaptationToolkit_adaptation_UIAdaptation_UIAdaptation.html">mediascape/AdaptationToolkit/adaptation/UIAdaptation/UIAdaptation</a></li><li><a href="module-mediascape_AdaptationToolkit_AdaptationToolkit.html">mediascape/AdaptationToolkit/AdaptationToolkit</a></li><li><a href="module-mediascape_AdaptationToolkit_componentManager_cssParser_cssParser.html">mediascape/AdaptationToolkit/componentManager/cssParser/cssParser</a></li><li><a href="module-mediascape_AdaptationToolkit_componentManager_loadManager_loadManager.html">mediascape/AdaptationToolkit/componentManager/loadManager/loadManager</a></li><li><a href="module-mediascape_AdaptationToolkit_componentManager_main_core.html">mediascape/AdaptationToolkit/componentManager/main/core</a></li><li><a href="module-mediascape_AdaptationToolkit_componentManager_modules.html">mediascape/AdaptationToolkit/componentManager/modules</a></li><li><a href="module-mediascape_AdaptationToolkit_uiComponents_uiComponents.html">mediascape/AdaptationToolkit/uiComponents/uiComponents</a></li></ul><h3>Classes</h3><ul><li><a href="module-mediascape_AdaptationToolkit_adaptation_multiDeviceAdaptation_mdadaptation-multiDeviceAdaptation.html">multiDeviceAdaptation</a></li><li><a href="module-mediascape_AdaptationToolkit_adaptation_UIAdaptation_UIAdaptation-UIAdaptation.html">UIAdaptation</a></li></ul><h3>Events</h3><ul><li><a href="module-mediascape_AdaptationToolkit_adaptation_multiDeviceAdaptation_mdadaptation.html#~event:applicationContext-ready">applicationContext-ready</a></li><li><a href="module-mediascape_AdaptationToolkit_adaptation_multiDeviceAdaptation_mdadaptation.html#~event:contextUpdate">contextUpdate</a></li><li><a href="module-mediascape_AdaptationToolkit_adaptation_multiDeviceAdaptation_mdadaptation.html#~event:layoutEvent">layoutEvent</a></li><li><a href="module-mediascape_AdaptationToolkit_adaptation_multiDeviceAdaptation_mdadaptation.html#~event:onComponentsChange">onComponentsChange</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.3</a> on Mon Jan 04 2016 09:35:16 GMT+0100 (CET)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
