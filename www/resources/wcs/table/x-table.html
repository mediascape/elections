<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="x-table" >


<template>
<style>
:host {
    display: block;
  }
#container {
	background-color: #0A2533;
	padding: 15px;
	height:100%;
}
div.content-detalle-graphs  {
	background-color: #173F56 !important;
	margin: auto;
	overflow: hidden;
	text-align: left;
	padding-left: 40px;
}
.template-all-layouts{height:auto;}
h1{color: #748c99; font-family: 'Montserrat', sans-serif; font-weight: bold; text-transform:uppercase;
font-size: xx-large;}
h1 span.tit01{padding-left:10%;}
h1 span.tit02{float:right;}

table{border-spacing: 10px; border-collapse: separate; width:100%;}
table th{text-align:center;}
table th img{display:block; width:50%; margin:auto; max-width:130px;}
table th p{background-color:#317da7; font-family: 'Montserrat', sans-serif; font-size:xx-large; text-transform:uppercase; color:#fff; padding:10px 0px;}

table td{background-color: #fff; font-family: 'Montserrat', sans-serif; font-size:; text-transform:uppercase; text-align:center; width:20%;}
table > tbody > tr:nth-child(2n+1) > th{background-color: #134054;}
table > tbody > tr:nth-child(2n+1) > td{ background-color: #c9d7dc;}

table td.td-name{width:20%;}
table td.td-img{width:20%;}
table td.td-img img{width:50%;}


@media (max-width: 1024px){
     div.content-detalle-graphs{padding-left:10px;}
    h1{font-size:x-large; padding:0px 10px;}
    td{font-size:x-large;}

    table {border-spacing: 10px;border-collapse: separate; width:100%;}
    p{margin:0; padding:10px 0px; font-size:large;}
    #img1{display:block;}
     #img2{display:block;}
     #img3{display:block;}
     #img4{display:block;}
     #img5{display:block;}

    #last1{display:table-row;}
     #last2{display:table-row;}
     #last3{display:table-row;}
     #last4{display:table-row;}
    #tdName{display:block;}
     #name0{display:table-cell;}
     #name1{display:table-cell;}
     #name2{display:table-cell;}
     #name3{display:table-cell;}
     #name4{display:table-cell;}
     #name5{display:table-cell;}

}
@media (min-width: 1025px){
    .content-detalle-graphs{padding-left:10px;}
    h1{font-size:xx-large; padding:0px 10px;}
    td{font-size:xx-large;}

    table {border-spacing: 10px;border-collapse: separate; width:100%;}
    p{margin:0; padding:10px 0px; font-size:x-large;}
    #img1{display:block;}
     #img2{display:block;}
     #img3{display:block;}
     #img4{display:block;}
     #img5{display:block;}

    #last1{display:table-row;}
     #last2{display:table-row;}
     #last3{display:table-row;}
     #last4{display:table-row;}
      #tdName{display: block;}
     #name0{display:table-cell;}
     #name1{display:table-cell;}
     #name2{display:table-cell;}
     #name3{display:table-cell;}
     #name4{display:table-cell;}
     #name5{display:table-cell;}
}
@media (max-width: 1024px) and (orientation: landscape){
    td{font-size:large;}

}

@media (max-width: 768px){
    #container{padding:5px;}
    table {border-spacing: 5px;border-collapse: separate; width:100%;}
    h1{font-size:medium; padding:0px 10px; margin:5px;}
    #img1{display:block;}
     #img2{display:block;}
     #img3{display:block;}
     #img4{display:block;}
     #img5{display:block;}
     #last1{display:table-row;}
     #last2{display:table-row;}
     #last3{display:table-row;}
     #last4{display:table-row;}
      td{font-size:medium;}
      #tdName{display: block;}
     #name0{display:table-cell;}
     #name1{display:table-cell;}
     #name2{display:table-cell;}
     #name3{display:table-cell;}
     #name4{display:table-cell;}
     #name5{display:table-cell;}
}

@media (max-width: 768px) and (orientation: landscape) {
    .content-progress{width:100% !important;}


    p{margin:0; padding:5px; font-size:small;}
    #logo0{width: 40%;}
    #logo1{width: 40%;}
    #logo2{width: 40%;}
    #logo3{width: 40%;}
    #logo4{width: 40%;}
    #logo5{width: 40%;}
    td{font-size:medium;}
    table {border-spacing: 5px !important;}






}
@media (max-width: 768px) and (orientation:portrait) {
    .content-progress{width:100% !important;}
    p{margin:0; padding:5px 0px; font-size:small;}
    #logo0{width: 40%;}
    #logo1{width: 40%;}
    #logo2{width: 40%;}
    #logo3{width: 40%;}
    #logo4{width: 40%;}
    #logo5{width: 40%;}
    td{font-size:medium;}



}
@media (max-width: 767px){
    tr{display:none;}
     tr:nth-child(-n+5){
        display:table-row;
    }
    #img1{display:block;}
     #img2{display:block;}
     #img3{display:block;}
     #img4{display:block;}
     #img5{display:block;}

}

@media (max-width: 600px){
    #container{padding:5px;}
    table {border-spacing: 5px;border-collapse: separate; width:100%;}
    h1{font-size:small; padding:0px 10px; margin:5px;}
    #img1{display:block;}
     #img2{display:block;}
     #img3{display:block;}
     #img4{display:block;}
     #img5{display:block;}
     #last1{display:table-row;}
     #last2{display:table-row;}
     #last3{display:table-row;}
     #last4{display:table-row;}
      td{font-size:medium;}
      #tdName{display: none;}
     #name0{display:none;}
     #name1{display:none;}
     #name2{display:none;}
     #name3{display:none;}
     #name4{display:none;}
     #name5{display:none;}
}
@media (max-width: 450px) and (orientation: landscape) {


     .td-img{width:20% !important;}
      table {border-spacing: 5px !important;}
      td{font-size:small;}
      p{margin:0; padding:5px 0px; font-size:small;}
     .td-name{display:none;}

     #logo0{width: 50%;}
     #logo1{width: 50%;}
     #logo2{width: 50%;}
     #logo3{width: 50%;}
     #logo4{width: 50%;}
     #logo5{width: 50%;}

     #img1{display:none;}
     #img2{display:none;}
     #img3{display:none;}
     #img4{display:none;}
     #img5{display:none;}
     #last1{display:table-row;}
     #last2{display:table-row;}
     #last3{display:table-row;}
     #last4{display:table-row;}
      h1{font-size:x-small; padding:0px 10px; margin:5px;}
      #tdName{display: none}
     #name0{display:none;}
     #name1{display:none;}
     #name2{display:none;}
     #name3{display:none;}
     #name4{display:none;}
     #name5{display:none;}


}
@media (max-width: 450px) and (orientation: portrait) {


     .td-img{width:20% !important;}
      table {border-spacing: 5px !important;}
      td{font-size:medium;}
      p{margin:0; padding:5px 0px; font-size:small;}


     #logo0{width: 50%;}
     #logo1{width: 50%;}
     #logo2{width: 50%;}
     #logo3{width: 50%;}
     #logo4{width: 50%;}
     #logo5{width: 50%;}

     #img1{display:none;}
     #img2{display:none;}
     #img3{display:none;}
     #img4{display:none;}
     #img5{display:none;}
     #last1{display:table-row;}
     #last2{display:table-row;}
     #last3{display:table-row;}
     #last4{display:table-row;}
      h1{font-size:x-small; padding:0px 10px; margin:5px;}
    #tdName{display: none;}
     #name0{display:none;}
     #name1{display:none;}
     #name2{display:none;}
     #name3{display:none;}
     #name4{display:none;}
     #name5{display:none;}

}
@media (max-width: 450px) and (orientation: landscape) and (max-height:275px) and (min-height:268px){


     .td-img{width:20% !important;}
      table {border-spacing: 5px !important;}
      td{font-size:medium;}
      p{margin:0; padding:5px 0px; font-size:small;}


     #logo0{width: 50%;}
     #logo1{width: 50%;}
     #logo2{width: 50%;}
     #logo3{width: 50%;}
     #logo4{width: 50%;}
     #logo5{width: 50%;}
     #last1{display:none;}
     #last2{display:table-row;}
     #last3{display:table-row;}
     #img1{display:none;}
     #img2{display:none;}
     #img3{display:none;}
     #img4{display:none;}
     #img5{display:none;}
     #tdName{display: none;}
     #name0{display:none;}
     #name1{display:none;}
     #name2{display:none;}
     #name3{display:none;}
     #name4{display:none;}
     #name5{display:none;}
     h1{font-size:x-small; padding:0px 10px; margin:5px;}
}
@media (max-width: 450px) and (orientation: landscape) and (max-height:267px) and (min-height:222px){


     .td-img{width:20% !important;}
      table {border-spacing: 5px !important;}
      td{font-size:medium;}
      p{margin:0; padding:5px 0px; font-size:small;}


     #logo0{width: 50%;}
     #logo1{width: 50%;}
     #logo2{width: 50%;}
     #logo3{width: 50%;}
     #logo4{width: 50%;}
     #logo5{width: 50%;}
     #last1{display:none;}
     #last2{display:none;}
     #last3{display:table-row;}
     #img1{display:none;}
     #img2{display:none;}
     #img3{display:none;}
     #img4{display:none;}
     #img5{display:none;}
     #tdName{display: none;}
     #name0{display:none;}
     #name1{display:none;}
     #name2{display:none;}
     #name3{display:none;}
     #name4{display:none;}
     #name5{display:none;}
     h1{font-size:x-small; padding:0px 10px; margin:5px;}
}
@media (max-width: 450px) and (orientation: landscape) and (max-height:221px) and (min-height:185px){


     .td-img{width:20% !important;}
      table {border-spacing: 5px !important;}
      td{font-size:medium;}
      p{margin:0; padding:5px 0px; font-size:small;}


     #logo0{width: 50%;}
     #logo1{width: 50%;}
     #logo2{width: 50%;}
     #logo3{width: 50%;}
     #logo4{width: 50%;}
     #logo5{width: 50%;}
     #last1{display:none;}
     #last2{display:none;}
     #last3{display:none;}
     #img1{display:none;}
     #img2{display:none;}
     #img3{display:none;}
     #img4{display:none;}
     #img5{display:none;}
     #tdName{display: none;}
     #name0{display:none;}
     #name1{display:none;}
     #name2{display:none;}
     #name3{display:none;}
     #name4{display:none;}
     #name5{display:none;}
     h1{font-size:x-small; padding:0px 10px; margin:5px;}
}
@media (max-width: 450px) and (orientation: landscape) and (max-height:184px) {


     .td-img{width:20% !important;}
      table {border-spacing: 5px !important;}
      td{font-size:medium;}
      p{margin:0; padding:5px 0px; font-size:small;}



     #logo0{width: 50%;}
     #logo1{width: 50%;}
     #logo2{width: 50%;}
     #logo3{width: 50%;}
     #logo4{width: 50%;}
     #logo5{width: 50%;}
     #last1{display:none;}
     #last2{display:none;}
     #last3{display:none;}
     #last4{display:none;}
     #img1{display:none;}
     #img2{display:none;}
     #img3{display:none;}
     #img4{display:none;}
     #img5{display:none;}
     #tdName{display:none;}
     #name0{display:none;}
     #name1{display:none;}
     #name2{display:none;}
     #name3{display:none;}
     #name4{display:none;}
     #name5{display:none;}
     h1{font-size:x-small; padding:0px 10px; margin:5px;}
}




</style>
<iron-ajax id="data" auto url="2015.json" handleAs="json" last-response="{{response}}"></iron-ajax>
     <div id='container' class="template-all-layouts ">
            <div class="col-md-12 layout-fullwidth content-detalle-graphs">
				<div >
                    <h1 style='position:relative;'><span id='counting' >100%</span><span id='year' class="tit01">2011</span> <span id='seatNum' class="tit02">Escaños a repartir 27</span></h1>
                </div>
                <table>
                    <tr>
                       <th class='td-politico'><img id='img1' src="data/icon_formacion_politica.png"/><p>Candidatura</p></th>
                       <th id='tdName'class="td-name"><img id='img2' src="data/none.png"/><p>&nbsp;</p></th>
                       <th><img id='img3' src="data/icon_urna.png"/><p>Votos</p></th>
                       <th><img id='img4' src="data/icon_porcentaje.png"/><p>% Votos</p></th>
                       <th><img id='img5' src="data/icon_escanos.png"/><p>Escaños</p></th>
                    </tr>
                    <tr>
                       <td id="name0" class="td-name">EAJ-PNV</td>
                       <td  class="td-img"><img id='logo0' src=""/></td>
                       <td id='votes0' class="td-op1">29.029</td>
                       <td id='perc0' class="td-op2">30,13</td>
                       <td id='seats0' class="td-op3">9</td>
                    </tr>
                    <tr>
                       <td id="name1" class="td-name">PSN-PSOE</td>
                       <td class="td-img"><img id='logo1' src=""/></td>
                       <td id='votes1' class="td-op1">29.029</td>
                       <td id='perc1' class="td-op2">30,13</td>
                       <td id='seats1' class="td-op3">9</td>
                    </tr>
                    <tr id='last4'>
                       <td id="name2" class="td-name">EH BILDU</td>
                       <td  class="td-img"><img id='logo2' src=""/></td>
                       <td id='votes2' class="td-op1">29.029</td>
                       <td id='perc2' class="td-op2">30,13</td>
                       <td id='seats2' class="td-op3">9</td>
                    </tr>
                    <tr id='last3'>
                       <td id="name3" class="td-name">PARTIDO POPULAR</td>
                       <td  class="td-img"><img id='logo3' src=""/></td>
                       <td id='votes3' class="td-op1">29.029</td>
                       <td id='perc3' class="td-op2">30,13</td>
                       <td id='seats3' class="td-op3">9</td>
                    </tr>
                    <tr id='last2'>
                       <td id="name4" class="td-name">PARTIDO POPULAR</td>
                       <td class="td-img"><img id='logo4'  src=""/></td>
                       <td id='votes4' class="td-op1">29.029</td>
                       <td id='perc4' class="td-op2">30,13</td>
                       <td id='seats4' class="td-op3">9</td>
                    </tr>
                    <tr id='last1'>
                       <td id="name5" class="td-name">PARTIDO POPULAR</td>
                       <td class="td-img"><img  id='logo5' src=""/></td>
                       <td id='votes5' class="td-op1">29.029</td>
                       <td id='perc5' class="td-op2">30,13</td>
                       <td id='seats5' class="td-op3">9</td>
                    </tr>

                </table>
			</div>
        </div>
</template>
</dom-module>
<script>
Polymer({

    is:'x-table',
    behaviors:[ComponentQueryBehavior,ComponentStatusBehavior],
    properties:{
      where:{
        type:String,
        value:'',
        notify: true
      },
      timestamp:{
         type:Number,
         value:0,
         observer:'timestampChanged'
      },
      value:{
         type:String,
         observer:'valueChanged'
      },
       	prevTime:{
          type:Number,
          value:1432509468
        },
        customCmd:{
            type:String,
            value:'',
            observer: 'customCmdReceived'
        }
    },
    resultsData:{},
    time:'',
    where:'',
   	actualShowing:true,


	ready:function(){
    this.showing = false;
    document.addEventListener ('motion-ready',this.smReady.bind(this));
    var scope=this;
		this.resultsData={};
		this.$.data.addEventListener("response",function(e){
			scope.resultsData=e.detail.response;


			for(var i=1;i<scope.resultsData.results.length;i++){
				if(scope.timestamp===scope.resultsData.results[i].time){
					scope.time=i;
				}
			}
			scope.where=3;//Iruñea por defecto
			scope.time=1;

			this.value='irunea';//iruñea por defecto
			scope.$.seatNum.innerHTML='Escaños: 26'
			scope.drawTable(scope.resultsData,scope.time,scope.where);

		});


	},
	smReady:function(){
  		// Sharemotion objetua lortu
  		var _this=this;

   		this.sm =  mediascape.AdaptationToolkit.SharedMotion();
  		// ebentuak entzun ta jaso
  		var handler = function (e) {
      		_this.timestamp=1432509468+Math.round(e.pos);


      	};
    	this.sm.mapp.motions.shared.on("timeupdate", handler);
	},
	actualData:function(){

		this.actualShowing=true;
		this.drawTable(this.resultsData,this.time,this.where);

	},
	pastData:function(){

		this.time=0;
		this.actualShowing=false;
		this.drawTable(this.resultsData,this.time,this.where);

	},
	timestampChanged:function(){

		var interval=10;
		var prev=this.time;
		if(this.resultsData.results!==undefined){
		var nextTs=false;
    var lng = this.resultsData.results.length;
		  for(var i=1;i<lng;i++){
          var time = this.resultsData.results[i].time;
          var time2 = typeof this.resultsData.results[i+1] !== "undefined" ? this.resultsData.results[i+1].time:this.resultsData.results[i].time;
          if(this.timestamp>=parseInt(time) && this.timestamp<=parseInt(time2))
    			{
    					 this.time=i;
    			}

			}

		if(prev!=this.time){
			if(this.actualShowing===true){

				this.drawTable(this.resultsData,this.time,this.where);
			}
		//	this.prevTime = this.timestamp;
		}


		}
	},

	valueChanged:function(){

  	if (this.value==='donostia') where=0;
		else if(this.value==='bilbo') where=1;
		else if(this.value==='gasteiz') where =2;
		else if(this.value==='irunea') where=3;
		else if(this.value==='gipuzkoa') where=4;
		else if(this.value==='bizkaia') where=5;
		else if(this.value==='araba') where =6;
		else if(this.value==='nafarroa') where=7;

		if(this.value==='irunea'){
			this.$.seatNum.innerHTML='Escaños: 26';
		}
		else if(this.value==='donostia'){
			this.$.seatNum.innerHTML='Escaños: 27';
		}
		else if(this.value==='bilbo'){
			this.$.seatNum.innerHTML='Escaños: 25';
		}
		else if(this.value==='gasteiz'){
			this.$.seatNum.innerHTML='Escaños: 27';
		}

    	this.where = where;
    	this.drawTable(this.resultsData,this.time,this.where);


	},
	drawTable:function(results,time,where){
    if (this.showing){
      		this.$.counting.innerHTML='Escrutado: '+results.results[time].places[where].counting;
      		if(this.$.counting.innerHTML.indexOf('%')<=-1){
      			this.$.counting.innerHTML=this.$.counting.innerHTML+'%';
      		}
      		if(time===0){
      			this.$.year.innerHTML=results.results[time].places[where].name+' 2011';
      		}
      		else{
      			this.$.year.innerHTML=results.results[time].places[where].name+' 2015';
      		}
      		for (var i=0;i<6;i++){

      			if(where===3 && i===4){
              this.querySelector('#name'+i).innerHTML='aranzadi';
            }
            else{
             this.querySelector('#name'+i).innerHTML=results.results[time].places[where].parties[i].name;
            }
      			this.querySelector('#logo'+i).src="/resources/images/icons/table/"+results.results[time].places[where].parties[i].icon;
          //  this.querySelector('#logo'+i).src="/resources/images/icons/table/bildu.png";
            this.querySelector('#votes'+i).innerHTML=results.results[time].places[where].parties[i].votes;
      			this.querySelector('#perc'+i).innerHTML=results.results[time].places[where].parties[i].percentage;
      			this.querySelector('#seats'+i).innerHTML=results.results[time].places[where].parties[i].councillors;

		     }
     }

	},
  customCmdReceived: function(data){
      console.log("DATA",data);
      if(data==='resultTablePast'){
      	this.pastData();
      }
      else if(data==='resultTablePresent'){
      	this.actualData();
      }
      else if(data==='bilbo'){
      	this.value='bilbo';
      	if(this.actualShowing===false){
      		this.pastData();
      	}
      }
      else if(data==='donostia'){
      	this.value='donostia';
      	if(this.actualShowing===false){
      		this.pastData();
      	}
      }
      else if( data==='gasteiz'){
      	this.value='gasteiz';
      	if(this.actualShowing===false){
      		this.pastData();
      	}
      }
      else if(data==='irunea'){
      	this.value='irunea';
      	if(this.actualShowing===false){
      		this.pastData();
      	}
      }

  },
  unload:function(){
      this.showing = false;
  },
  load:function(){
    this.where= this.where || 3;//Iruñea por defecto
    this.time= this.time || 1;

    this.value= this.value || 'irunea';//iruñea por defecto
    this.$.seatNum.innerHTML= this.$.seatNum.innerHTML || 'Escaños: 26'
    this.showing = true;
    this.drawTable(this.resultsData,this.time,this.where);

  }


});
 </script>
