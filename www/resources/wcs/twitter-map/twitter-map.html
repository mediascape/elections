
<dom-module name="twitter-map" >
	<template>
		<style>
#map {
	background-color: #0A2533;

}


/************** mapa **********************/

.logos-partidos {
	position: relative;
	margin-bottom: 20px;
}
.detalle-mapa {text-align: center;}
.detalle-mapa img {
	margin-top: 10%;
	width: 90%;
	margin: auto;
}
.logo-container {
	position: absolute;
	padding-top:2%;
	top:0;
}

.detalle-logo {
	padding: 0;
}
.detalle-logo span img {
	width: 35%;
	background-color: white;
	-webkit-border-radius: 15px;
	-moz-border-radius: 15px;
	border-radius: 15px;
	box-shadow: 0px 0px 15px rgba(0,0,0,0.5);
}
/* posicion de cada logo */
.detalle-logo.logo-1 {
	text-align: center;
	padding-top: 3%;
}
.detalle-logo.logo-2 {
	text-align: left;
	padding-top: 30%;
}
.detalle-logo.logo-3 {
	text-align: left;

}
.detalle-logo.logo-4 {
	text-align: center;
	padding-top: 20%;
}



/* politic party */
.politic-party {
	background-color: #22536B !important;
	margin-bottom: 20px;
}
.politic-party h2 {
	color: #91b5ce;
	font-family: 'Montserrat', sans-serif;
	font-weight: bold;
	font-size: 4vw;
	padding-top: 15%;
}
.politic-party img {width: 75%;}
.cont-tweets {
	color: #55b2ff !important;
}


/* responsive */
@media (min-width: 1280px) and (orientation: landscape) {
	.logos-partidos { margin-bottom: 0px;}
	#mapa {
		width: 65%;
		position:relative;
	}

	#bizkaiaLogo{
		width:30%;
	}
	#gipuzkoaLogo{
		width: 30%;
	}
	#arabaLogo{
		width: 30%;
	}
	#nafarroaLogo{
		width: 30%;
	}

	.logo-1 {
		text-align: right;
	}
	.logo-2 {
		padding-top: 21%;
	}
	.logo-4 {
		text-align: left;
		padding-top: 15%;
	}
	h2 {
		font-size: 2.5vw;
		padding-top: 0px;
	}
	.politic-party {
		height: 115px;
		display:block;
		padding-top: 5px !important;
	}
	#hegoEuskalLogo{ width: 100px; }
	.logos-partidos { display: block;}
	#part1{
		width:33%;
	}
	#part2{
		width:33%;
		text-align:center;
	}
	#part3{
		width:33%;
	}

}
@media (min-width: 1025px) and (max-width: 1280px) and (orientation: landscape) {
	.logos-partidos { margin-bottom: 0px;}
	#mapa {
		width: 65%;
		position:relative;
	}

	#bizkaiaLogo{
		width:30%;
	}
	#gipuzkoaLogo{
		width: 30%;
	}
	#arabaLogo{
		width: 30%;
	}
	#nafarroaLogo{
		width: 30%;
	}

	.logo-1 {
		text-align: right;
	}
	.logo-2 {
		padding-top: 21%;
	}
	.logo-4 {
		text-align: left;
		padding-top: 15%;
	}
	h2 {
		font-size: 2.5vw;
		padding-top: 0px;
	}
	.politic-party {
		height: 115px;
		display:block;
		padding-top: 5px !important;
	}
	#hegoEuskalLogo{ width: 100px; }
	.logos-partidos { display: block;}
	#part1{
		width:33%;
	}
	#part2{
		width:33%;
	}
	#part3{
		width:33%;
	}

}

@media (max-width: 1024px) and (orientation: landscape){

	#mapa {
		width: 80%;
	}
	#bizkaiaLogo{
		width:30%;
	}
	#gipuzkoaLogo{
		width: 30%;
	}
	#arabaLogo{
		width: 30%;
	}
	#nafarroaLogo{
		width: 30%;
	}
	.logo-1 {
		text-align: center;
	}
	.logo-2 {
		padding-top: 25%;
	}
	.logo-4 {
		text-align: left;
		padding-top: 25%;
	}
	h2 {
		font-size: large;
		padding-top: 0px;
	}
	.politic-party {
		height: 115px;
		display:block;
		padding-top: 5px !important;
	}
	#hegoEuskalLogo{ width: 100px; }

	.logos-partidos { display: block;}
	#part1{
		width:33%;
	}
	#part2{
		width:33%;
	}
	#part3{
		width:33%;
	}
}

@media (max-width: 1024px) and (orientation: portrait){
	#mapa {
		width: 95%;
	}
	#bizkaiaLogo{
		width:35%;
	}
	#gipuzkoaLogo{
		width: 35%;
	}
	#arabaLogo{
		width: 35%;
	}
	#nafarroaLogo{
		width: 35%;
	}
	.politic-party {
		height: 100%;
		text-align: center;
	}
	h2 { font-size: large; padding-top: 5px;}
	.logo-party { text-align: center;}
	#hegoEuskalLogo{ width: 180px; }
	.logos-partidos { display: block;}
	#part1{
		width:33%;
	}
	#part2{
		width:33%;
	}
	#part3{
		width:33%;
	}
	.politic-party{
		display:block;
	}
}

@media (max-width: 767px) and (orientation: portrait){
	.logos-partidos { display: block;}
	.politic-party {
		height: 150px;
		text-align: center;
		display:block;
	}
	 h2 { font-size: large;}
	.logo-party { text-align: center;}
	#hegoEuskalLogo { width: 130px; }
	#part1{
		width:33%;
	}
	#part2{
		width:33%;
	}
	#part3{
		width:33%;
	}

}

@media (max-width: 767px) and (orientation: landscape) and (max-height:450px){

	.politic-party {
		height: 130px;
		text-align: center;
		padding-top: 10px !important;
		display:none;

	}
	h2 { font-size: medium; padding-top: 5px !important;}

	.logo-party { text-align: center;}


	.logos-partidos { display: block;}
	#hegoEuskalLogo { width: 100px; }
	#part1{
		width:33%;
	}
	#part2{
		width:33%;
	}
	#part3{
		width:33%;
	}
}
@media (max-width: 767px) and (orientation: landscape) and (max-height:300px){

	.politic-party {
		height: 100%;
		text-align: center;
		padding-top: 10px !important;
		display:block;

	}
	h2 { font-size: medium; padding-top: 5px !important;}

	.logo-party { text-align: center;}


	.logos-partidos { display: none;}
	#hegoEuskalLogo { width: 100px; }
	#part1{
		width:33%;
	}
	#part2{
		width:33%;
	}
	#part3{
		width:33%;
	}
}

@media (max-width: 480px) and (orientation: portrait){
	.logos-partidos { display: none;}
	.politic-party {
		height: 100%;
		text-align: center;
		padding-top: 10px !important;
		display:block;
	}
	h2 { font-size: xx-large;}
	
	.logo-party { text-align: center;}
	#hegoEuskalLogo{ width: 200px;}
	#part1{
		width:100%;
	}
	#part2{
		width:100%;
	}
	#part3{
		width:100%;
	}

}

@media (max-width: 480px) and (min-height:235px) and (orientation: landscape){

	.logos-partidos { display: none;}
	.politic-party {
		height: 100%;
		text-align: center;
		padding-top: 10px !important;
		display:block;
	}
	#text1{font-size: small;padding-top: 0px !important;}
	#tweetNum{font-size: small;padding-top: 0px !important;}

	
	.logo-party { text-align: center;}
	#hegoEuskalLogo{ width: 100px; }
	#part1{
		width:100%;
	}
	#part2{
		width:100%;
	}
	#part3{
		width:100%;
	}

}
@media (max-width: 480px) and (max-height:234px) and (orientation: landscape){
	.logos-partidos { display: none;}
	.politic-party {
		height: 100%;
		text-align: center;
		padding-top: 10px !important;
		display:block;
	}


	#text1{font-size: small;padding-top: 0px !important;}
	#tweetNum{font-size: small;padding-top: 0px !important;}
	.logo-party { text-align: center;}
	#hegoEuskalLogo{ width: 100px; }
	#part1{
		width:33%;
	}
	#part2{
		width:33%;
	}
	#part3{
		width:33%;
	}

}



		</style>
		<iron-ajax id="data" auto url="mapData.json" handleAs="json" last-response="{{mapResponse}}"></iron-ajax>
		<div class="template-all-layouts" id='map'>
		<div class="col-md-12 col-sm-12 layout-fullwidth componente-mapa">
                <div class="col-md-12 content-detalle-twitter-mapa">
					<div class="logos-partidos">
						<div class="detalle-mapa"><img id='mapa' src="detalle-twitter/mapa_suelto.png"/></div>
						<div class="logo-container" style='width:100%'>
							<div class="detalle-logo col-md-3 logo-1 col-sm-3 col-xs-3"><span><img id='bizkaiaLogo' src="detalle-twitter/logo-Bildu-transp.png"/></span></div>
							<div class="detalle-logo col-md-3 logo-2 col-sm-3 col-xs-3"><span><img id='arabaLogo'src="detalle-twitter/logo-PNV-transp.png"/></span></div>
							<div class="detalle-logo col-md-3 logo-3 col-sm-3 col-xs-3"><span><img id='gipuzkoaLogo' src="detalle-twitter/logo-podemos-transp.png"/></span></div>
							<div class="detalle-logo col-md-3 logo-4 col-sm-3 col-xs-3"><span><img id='nafarroaLogo' src="detalle-twitter/logo-Bildu-transp.png"/></span></div>
						</div>
					</div>

				</div>
				<div class="col-md-12 politic-party" >

					<div id='part1' class="col-md-4 col-sm-12 col-xs-12"><h2 id='text1'>Trending Politic party:</h2></div>
					<div id='part2' class="col-md-4 col-sm-12 col-xs-12 logo-party"><img id='hegoEuskalLogo' src="detalle-twitter/logo-PNV-transp.png" /></div>
					<div id='part3' class="col-md-4 col-sm-12 col-xs-12"><h2  class="cont-tweets titulo-resp" id='tweetNum'>0 tweets</h2></div>

				</div>
            </div>
        </div>

	</template>
</dom-module>
	<script>
		Polymer({			
			

				is:'twitter-map',
			  behaviors:[ComponentQueryBehavior,ComponentStatusBehavior],
				properties:{
					prevTime:{
						type:Number,
						value:1432509468
					},
					showing:{
							type:Boolean,
							value:false,

					},
					timestamp:{
						type:Number,
						value:0,
						observer:'timestampChanged'
					},
					time:''
				},
				created: function() {
					console.log('twitter-map created');
					//instancia de socket en el lado cliente


				},


				ready: function() {
					console.log('twitter-map ready');
					var _this=this;
					document.addEventListener ('motion-ready',this.smReady.bind(this));

					var scope=this;
					

					this.mapResults={};
					this.$.data.addEventListener("response",function(e){
						_this.mapResults=e.detail.response;
						_this.timestamp=1432509468;

					});

					
				},
				smReady:function(){
					// Sharemotion objetua lortu
					var _this=this;
					this.sm = mediascape.AdaptationToolkit.SharedMotion();
					// ebentuak entzun ta jaso
					var handler = function (e) {
						_this.timestamp=1432509468+Math.round(e.pos);
						
					};
					this.sm.mapp.motions.shared.on("timeupdate", handler);
				},
				timestampChanged:function(){
					//console.log("timestampChanged");
					var interval=10;
					var prev=this.time;
					if(this.mapResults!==undefined){
						var nextTs=false;
						for(var i=1;i<this.mapResults.results.length;i++){
								if(this.timestamp===parseInt(this.mapResults.results[i].time))
								{

									 this.time=i;
									nextTs=true;
								}

						}
						if(nextTs===false){
							for(var i=1;i<this.mapResults.results.length;i++){
								if(this.timestamp>parseInt(this.mapResults.results[i].time) && this.timestamp<parseInt(this.mapResults.results[i+1].time)){
									this.time=i;

								}
							}
						}

						if(prev!=this.time){								
							this.$.gipuzkoaLogo.src="./resources/images/twitter/"+this.calculateMax(this.mapResults.results[this.time].gipuzkoa)[0]+'-logo.png';
							this.$.bizkaiaLogo.src="./resources/images/twitter/"+this.calculateMax(this.mapResults.results[this.time].bizkaia)[0]+'-logo.png';
							this.$.arabaLogo.src="./resources/images/twitter/"+this.calculateMax(this.mapResults.results[this.time].araba)[0]+'-logo.png';
							this.$.nafarroaLogo.src="./resources/images/twitter/"+this.calculateMax(this.mapResults.results[this.time].nafarroa)[0]+'-logo.png';
							this.$.hegoEuskalLogo.src="./resources/images/twitter/"+this.calculateMax(this.mapResults.results[this.time].euskadi)[0]+'-logo.png';
							this.$.tweetNum.innerHTML=this.calculateMax(this.mapResults.results[this.time].euskadi)[1]+" tweets";
						}


					}
				},

				unload:function(){
						this.showing =false;
				},
				load:function(){
					 this.showing =true;
				},
				
				calculateMax:function(values){
					var max=0;
					var maxIndex=0;
					for(var i=0;i<values.length;i++){
						if(values[i].value>max){
							max=values[i].value;
							maxIndex=i;
						}
					}
					var res=[values[maxIndex].name,values[maxIndex].value];
					return res;
				}




		});
</script>
