<dom-module id="x-media" >



<template>
	<style >



	#container {
	background-color: #0A2533;
	padding: 5px;
	height:100%;
}
	@media (max-width:350px){
		video{width:100%;height:100%;}



	}
	@media (min-width:351px){
		video{width:100%;height:100%;}


	}

</style>

<div  id="container"  class='template-all-layouts'>
	<video id='{{ida}}' preload mute src></video>
</div>

</template>
</dom-module>
<!--<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>-->
 <script>
Polymer({
	is:'x-media',
  behaviors:[ComponentQueryBehavior,ComponentStatusBehavior],
	hostAttributes:{
		skew:0.0,
		sm:null,
		l:''
	},
	properties:{
		file:{
			 type:String,

		},
			ismuted:{
				type:String,
				value:'false'
			},
			customCmd:{
	        type:String,
	        value:'',
	        observer: 'customCmdReceived'
	    },
			ida:String
	},

	ready: function() {
		var _this = this;
		document.addEventListener ('motion-ready',this.smReady.bind(this));
		this.ida = "player1"+this.id;
	},
	muteChanged:function(){
		 if (this.mute === true){

		}
	},
	smReady:function(e){
		var video ="";
		var _this = this;
		this.sm = mediascape.AdaptationToolkit.SharedMotion();
		var id = 0;
		setTimeout(function(){
			 var video = _this.querySelector('video')
			 //video.src=_this.file;
			_this.sm.addVideo (video,id,_this.skew);
	  	 _this.play();
			  var cmpStatus = mediascape.AdaptationToolkit.componentManager.core.getComoponentsToShow();
				if (cmpStatus) mediascape.AdaptationToolkit.Adaptation.UIAdaptation.onComponentsChange(cmpStatus);
				if (navigator.userAgent.toLowerCase().indexOf('hbbtv')!=-1) 	mediascape.AdaptationToolkit.Adaptation.UIAdaptation.useLayout('divided');

	},4000);
	if (navigator.userAgent.toLowerCase().indexOf('hbbtv')!=-1){

			function handler(e){
				var time = _this.sm.mapp.motions.shared.query();
			//	document.querySelector('#output').innerHTML = time.pos;
				try {
					  var video = _this.querySelector('video');
						//video.currentTime = time /1000;
					try {
					 //if (Math.abs(video.currentTime - time.pos+0.345)>1)
						video.currentTime = time.pos+0.345;
					}catch(e){}
				//	if (video.playState!=2 || video.playState!=3 || video.playState!=4) video.play(1);
				//	video.seek(time);
				}
				catch (e){

				}
			}
			setInterval(handler,2000);


		}

  },
	play:function(){
		if (this.sm) this.sm.mapp.motions.shared.update(null, 1);
	},

  start_volumeChanged:function(currentVol){
		this.$.container.children[0].volume=parseInt(currentVol);
	},

	mutePlayer:function(){
		this.$.container.children[0].muted=true;
	},
	soundPlayer:function(){
		this.$.container.children[0].muted=false;
	},
	restart: function (){
		this.sm.mapp.motions.shared.update(0, 1);
	},
	customCmdReceived: function(data){
			console.log("DATA",data);
			if(data==='mutePlayer'){
				this.mutePlayer();
			}
			else if(data==='soundPlayer'){
				this.soundPlayer();
			}
			else if(data==='offSound'){

			}
			else if(data==='onSound'){
				this.soundPlayer();
			}
	},
	unload:function(){
		 var video = this.querySelector('video');
		 video.src ="";
		 console.log("UNLOADING");
     video.mute = true;
		 video.volumen =0;
	},
	load:function(){
	     var video = this.querySelector('video');
			 video.src = this.file;
			 if(this.ismuted==="true"){
				 video.muted=true;
				  video.volume =0;
			 }
			 else {
				 	video.muted = false;
					video.volume = 0.9;
			 }
			 	if (navigator.userAgent.toLowerCase().indexOf('hbbtv')!=-1)
					{
						this.play();
						mediascape.AdaptationToolkit.Adaptation.UIAdaptation.useLayout('divided');
					}
				//mediascape.AdaptationToolkit.Adaptation.UIAdaptation.useLayout('divided');
	}
});
 </script>
